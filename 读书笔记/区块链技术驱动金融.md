### 1.2 哈希指针及数据结构
> 哈希指针是指一个指向数据存储位置及其位置数据的哈希值的指针。一个普通的指针可以告诉你数据存储的位置，哈希指针不但可以告诉你的数据存储的位置，并且还可以给你一种方式，让你验证数据没有被篡改过。

> 哈希指针是一个不但可以指向数据存储的位置，还可以明晰某个时间戳下该数据的哈希值的指针。

**区块链**
> 通过哈希指针构建一个链表，我们将这个数据结构称为区块链(block chain)。在普通链表中有一系列区块，每个a区块既有数据也有一个指向上一个区块的指针。而在区块链中，上一个区块指针被置换成哈希指针。因此，每个区块不仅能告诉我们上一个区块的值在哪里，还包含了该值的摘要，使我们能够验证那个值没有改变。我们存储链表头部(the head of list)，即一个普通的哈希指针指向最近使用的数据区块。

**创世区块(genesis block)**
> 可以搭建一个包含很多区块的区块链网络，链表头部的哈希指针被称为创世区块

**梅克尔树**
> 使用哈希指针的二叉树也叫作梅克尔树(Merkle trees)

![](assets/markdown-img-paste-20180606080918987.png)

> 在梅克尔树的数据结构中，所有的数据区块都被两两分组，指向这些数据区块的指针被存储在上一层的父节点(parent node)中，而这些父节点再次被两两分组，并且指向父节点的指针被存储在上一层的父节点中，一直持续这个过程，直到最后我们到达树的根节点。

**隶属证明**
> 我们只记住树根节点，然后他需要展示给我们数据块信息，以及从该数据区块通向树根节点的那些区块，我们可以忽略树的其余部分。

**非隶属证明**
> 我们只需要通过展示被验证区块之前的区块路径，以及被验证区块之后的区块路径，就可以达到目的。如果之前、之后两个区块在树上是连续的，那么这说明了被验证区块与该梅克尔树之间是非隶属关系。因为被验证区块确实隶属于梅克尔树，它需要在两个条目之间，而如果两个条目是连续的话，二者之间则并没有空间。

> 我们可以在任何以指针为基础的数据结构中使用哈希指针，条件是数据结构不存在循环。如果一个非循环的数据结构中，我们可以在靠近节点的地方开始，或者在没有指针的数据区块开始，计算其哈希值，然后从后往前进行计算。但是在一个有循环结构的网络中，并没有一个根节点，可以让我们去追溯。


## 2.1 中心化与去中心化
1. 谁在维护交易账本？
2. 谁有权利批准哪个交易是正当有效的？
3. 谁在制造新的比特币？
4. 谁在制定系统变化规则？
5. 比特币是如何取得交易价值的？

## 2.2 分布式共识
- 分布式共识(distributed consensus)
> 建立一个分布式的电子现金系统的关键技术问题，就在于要达成分布式共识
> **在一个有n个节点的系统中，每一个节点都有一个输入值，其中一些节点具有故障，甚至是恶意的。一个分布式共识协议有以下两个属性：**
1、输入值的中止须经所有诚实节点来确定
2、这个输入值必须由诚实节点来生成

> 在比特币网络里，节点到底要达成什么样的共识呢？网络里有各种各样的用户在向网络广播交易，节点必须对哪些交易可以进行广播和交易发生的次序达成共识，以此系统将形成一个唯一的全球交易总账。

> 在任何时点，所有在点对点网络上的节点都有包含一系列区块的总账本，每个区块中都包含了已经被所有节点达成共识的交易清单。除此之外，每个节点还有一堆没有打包进区块的交易，就是那些网络节点已经被通知、交易已经发生，但还没有被写进区块的交易。网络节点对于这些交易还没有达成共识，所以每个节点都有一个略有差异、尚待确认的交易池。在实际中，点对点网络是不完美的，所有有些节点听到了交易，而有些节点却没有听到。

> 那么，所有的节点是如何对一个区块达成共识的呢？一个方法是，在一个时间段里，比如每隔十分钟，每个节点都提议，自己的未被认可的交易成为已经达成共识的区块链后面的下一个区块，然后那些节点会执行一些共识协议，每个节点把自己提议的区块作为输入。但不可避免地，有些节点可能是恶意的，存心要把不当交易放进区块里，其他节点则是诚实的。如果共识协议能够顺利完成，一个正当有效的区块会被选做输出值。尽管有些被选出的区块是由一个节点提交，但只要这个区块是正当有效的，输出就是正当有效的。如果被选出区块可能未包含所有的正当有效的交易，但这并没有关系，如果有些正当有效的交易没被放进区块，他们可以等待下一次机会。

- 技术难点
1. 达成共识一般是个难题，因为有些节点会死机或者根本就是恶意节点
2. 点对点网络是不完美的，并非所有对应的节点是两两相连的，互联网链接的不良可能会造成网络问题，要执行一个所有节点都参与的共识协议好像并不现实
3. 交易信息分布在整个互联网上，信息传递会有严重延迟

### 延迟与全球时间
> 严重网络延迟导致的一个后果是，节点之间没有一个统一的全球时间概念。并非所有的节点都能根据每个交易的时间戳来达成交易时间共识，因此，共识协议不能执行以下指令：“在第一步里发了第一个消息的节点必须在第二步里执行X”。这一做法根本无法执行，因为所有的节点对于谁在第一步中发出第一个消息有不同的看法。

### 不可能性结论
- 拜占庭将军问题
- Fischer-Lynch-Paterson

### 打破传统上的假设
1. 比特币引进了奖励的理念，这对分布式共识协议来说是一个全新的理念，因为比特币也是个货币，所以人们自然而然地为了金钱奖励而变得城市起来。所以比特币并没有真正解决分布式共识问题，它只是在特定货币系统下解决了这个问题而已。
2. 比特币体系包含随机性这个概念。也不再纠结于规定共识的起点与终点。相反，共识是通过一段长的时间而达成的，在实际系统中，达成共识大约需要一个小时左右。但即使在一个小时以后，节点们也无法确定哪一个交易块应该进入总账本。但随着时间的流逝，我们对某一个块的认识与最终总体共识相吻合的概率将越来越大，观点出现分歧的概率按指数级下降。

## 2.3 使用区块链达成没有身份的共识
